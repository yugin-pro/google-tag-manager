/*
Using Intersection Observer API for e-commerce tracking via GTM
https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API
*/

const intersectionCallback = (entries) => {
  entries.forEach((entry) => {
    if (entry.isIntersecting) {
      if (entry.intersectionRatio >= 0.75) {
        let itemValue =      entry.target.getElementsByClassName('card-text')[0].getInnerHTML()
        dataLayer.push({ ecommerce: null });  
        dataLayer.push({
          event: "view_item_list",
          ecommerce: {
            item_list_id: itemValue,
            item_list_name: itemValue,
            items: [
             {
              item_id: "SKU_" + Math.floor(Math.random() * 5 + 1),
              item_name: itemValue,
              affiliation: "Google Merchandise Store",
              coupon: "SUMMER_FUN",
              discount: Math.floor(Math.random() * 5 + 1),
              index: Math.floor(Math.random() * 8 + 1),
              item_brand: "brand_"+ Math.floor(Math.random() * 5 + 1),
              item_category: "category"+ Math.floor(Math.random() * 5 + 1),
              item_category2: "category2_"+ Math.floor(Math.random() * 5 + 1),
              item_category3: "category3_"+ Math.floor(Math.random() * 5 + 1),
              item_category4: "category4_"+ Math.floor(Math.random() * 5 + 1),
              item_category5: "category5_"+ Math.floor(Math.random() * 5 + 1),
              item_list_id: itemValue,
              item_list_name: itemValue,
              item_variant: "variant_"+Math.floor(Math.random() * 5 + 1),
              location_id: "ChIJIQBpAG2ahYAR_6128GcTUEo",
              price: Math.floor(Math.random() * 50 + 1),
              quantity: Math.floor(Math.random() * 5 + 1)         
            }]
          }
        });
      }
    }
  });
};


const productObserver  =  new IntersectionObserver(intersectionCallback,{
  root: null,
  rootMargin: "50px",
  threshold: 1,
});

let cardCollection = document.getElementsByClassName('card shadow-sm')
for (let item of cardCollection) {
    productObserver.observe(item)
}
